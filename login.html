<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login | ECS Mentoring Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    .login-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(160deg, #f8fafc 0%, #e8ecf7 50%, #e0e7ff 100%); font-family: 'Poppins', sans-serif; }
    .login-card { background: rgba(255,255,255,0.9); backdrop-filter: blur(12px); border-radius: 24px; padding: 2.5rem; box-shadow: 0 12px 40px rgba(0,0,0,0.1); width: 100%; max-width: 400px; border: 1px solid rgba(255,255,255,0.6); }
    .login-card h1 { font-size: 1.5rem; margin-bottom: 0.25rem; color: #0f172a; }
    .login-card p { color: #64748b; font-size: 0.9375rem; margin-bottom: 1.5rem; }
    .login-card label { display: block; font-size: 0.875rem; font-weight: 500; color: #334155; margin-bottom: 0.35rem; }
    .login-card input, .login-card select { width: 100%; padding: 0.75rem 1rem; border: 1px solid #e2e8f0; border-radius: 12px; font-family: inherit; font-size: 1rem; margin-bottom: 1rem; }
    .login-card input:focus, .login-card select:focus { outline: none; border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99,102,241,0.2); }
    .login-card button[type="submit"] { width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: #fff; border: none; border-radius: 12px; font-family: inherit; font-size: 1rem; font-weight: 600; cursor: pointer; transition: opacity 0.2s; }
    .login-card button[type="submit"]:hover { opacity: 0.95; }
    .login-card .error { color: #dc2626; font-size: 0.875rem; margin-top: 0.5rem; }
    .login-card .brand { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem; }
    .login-card .brand span:first-child { font-size: 1.5rem; color: #8b5cf6; }
    .login-card .brand span:last-child { font-weight: 700; font-size: 1.25rem; color: #1e293b; }
  </style>
</head>
<body class="login-page">
  <div class="login-card">
    <div class="login-brand brand">
      <span>◆</span>
      <span>ECS Mentoring Portal</span>
    </div>
    <h1>Sign in</h1>
    <p>Enter your credentials to access the dashboard.</p>
    <p style="font-size: 0.8rem; color: #64748b; margin-bottom: 1rem;">Students: <strong>rollno@crce.edu.in</strong> / roll no (or rollno@ecs.edu / student123 if from attendance import). Role = Student. Admin: admin@ecs.edu / admin123.</p>
    <form id="login-form">
      <label for="email">Email</label>
      <input type="email" id="email" name="email" required placeholder="you@college.edu" autocomplete="email">
      <label for="password">Password</label>
      <input type="password" id="password" name="password" required placeholder="••••••••" autocomplete="current-password">
      <label for="role">Login as</label>
      <select id="role" name="role">
        <option value="student">Student</option>
        <option value="teacher">Teacher</option>
        <option value="parent">Parent</option>
        <option value="admin">Admin</option>
      </select>
      <div id="login-error" class="error" role="alert" aria-live="polite"></div>
      <button type="submit">Sign in</button>
    </form>
  </div>
  <script src="api.js"></script>
  <script>
    (function () {
      if (ECS_API.isLoggedIn()) {
        window.location.href = 'index.html';
        return;
      }
      const form = document.getElementById('login-form');
      const errorEl = document.getElementById('login-error');
      form.addEventListener('submit', async function (e) {
        e.preventDefault();
        errorEl.textContent = '';
        const email = document.getElementById('email').value.trim().toLowerCase();
        const password = document.getElementById('password').value.trim();
        try {
          const data = await ECS_API.auth.login(email, password);
          if (data.success) {
            ECS_API.setAuth('session', { email: email, role: data.role, name: data.name, mentorEmail: data.mentorEmail || null });
            window.location.href = 'index.html';
          } else {
            errorEl.textContent = data.message || 'Login failed';
          }
        } catch (err) {
          errorEl.textContent = err.message || 'Login failed. Check your connection and try again.';
        }
      });
    })();
  </script>
</body>
</html>
